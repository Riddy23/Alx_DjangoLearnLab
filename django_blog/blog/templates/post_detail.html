{% extends 'base.html' %}
{% block content %}
  <article>
      <h2>{{ object.title }}</h2>
          <p>By {{ object.author }} — {{ object.published_date }}</p>
              <div>{{ object.content|linebreaks }}</div>
                  <p>Tags:
                        {% for tag in object.tags.all %}
                                <a href="{% url 'blog:posts_by_tag' tag.name %}">{{ tag.name }}</a>{% if not forloop.last %}, {% endif %}
                                      {% empty %}
                                              none
                                                    {% endfor %}
                                                        </p>

                                                            {% if user == object.author %}
                                                                  <p>
                                                                          <a href="{% url 'blog:post_update' object.pk %}">Edit</a> |
                                                                                  <a href="{% url 'blog:post_delete' object.pk %}">Delete</a>
                                                                                        </p>
                                                                                            {% endif %}
                                                                                              </article>

                                                                                                <section>
                                                                                                    <h3>Comments</h3>
                                                                                                        {% for comment in object.comments.all %}
                                                                                                              <div>
                                                                                                                      <strong>{{ comment.author.username }}</strong> — {{ comment.created_at }}
                                                                                                                              <p>{{ comment.content|linebreaks }}</p>
                                                                                                                                      {% if user == comment.author %}
                                                                                                                                                <a href="{% url 'blog:comment_edit' comment.pk %}">Edit</a>
                                                                                                                                                          <a href="{% url 'blog:comment_delete' comment.pk %}">Delete</a>
                                                                                                                                                                  {% endif %}
                                                                                                                                                                        </div>
                                                                                                                                                                              <hr/>
                                                                                                                                                                                  {% empty %}
                                                                                                                                                                                        <p>No comments yet.</p>
                                                                                                                                                                                            {% endfor %}

                                                                                                                                                                                                {% if user.is_authenticated %}
                                                                                                                                                                                                      <form action="{% url 'blog:add_comment' object.pk %}" method="post">
                                                                                                                                                                                                              {% csrf_token %}
                                                                                                                                                                                                                      {{ comment_form.as_p }}
                                                                                                                                                                                                                              <button type="submit">Post comment</button>
                                                                                                                                                                                                                                    </form>
                                                                                                                                                                                                                                        {% else %}
                                                                                                                                                                                                                                              <p><a href="{% url 'login' %}?next={{ request.path }}">Log in</a> to post a comment.</p>
                                                                                                                                                                                                                                                  {% endif %}
                                                                                                                                                                                                                                                    </section>

                                                                                                                                                                                                                                                    {% endblock %}
                                                                                                                                                                                                                                                    